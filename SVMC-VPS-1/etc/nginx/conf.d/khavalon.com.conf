# Main Record
server {
    server_name khavalon.com;
    root /var/minecraft/khavalon-website/content;
    listen 443 ssl http2; # managed by Certbot

    add_header Strict-Transport-Security "max-age=2592000; includeSubDomains" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options DENY always;

    rewrite ^/vote(/)?$ https://www.semivanilla.com/vote permanent;
    rewrite ^/(.*)$ https://www.semivanilla.com permanent;

    gzip on;
    gunzip on;
    gzip_disable "msie6";

    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_min_length 256;
    gzip_types
      application/atom+xml
      application/geo+json
      application/javascript
      application/x-javascript
      application/json
      application/ld+json
      application/manifest+json
      application/rdf+xml
      application/rss+xml
      application/xhtml+xml
      application/xml
      font/eot
      font/otf
      font/ttf
      image/svg+xml
      text/css
      text/javascript
      text/plain
      text/xml;

    ssl_certificate /etc/letsencrypt/live/khavalon.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/khavalon.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    ssl_buffer_size 4k;

}

# Redirect HTTPS WWW to NON-WWW
server {
    server_name www.khavalon.com;
    listen 443 ssl http2; # managed by Certbot

    return 301 http://khavalon.com$request_uri;

    ssl_certificate /etc/letsencrypt/live/khavalon.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/khavalon.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    ssl_buffer_size 4k;

}

# Redirect HTTP to HTTPS
server {
    server_name .khavalon.com;
    listen 80;

    return 301 https://khavalon.com$request_uri;
}
